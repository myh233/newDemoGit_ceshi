<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,aItemress=no">
    <title>个性推荐</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style type="text/css">
      #search{
        position: relative;
        top:50px;
      }
    </style>
</head>
<body>
    <div class="aui-searchbar" id="search">
        <div class="aui-searchbar-input aui-border-radius">
            <i class="aui-iconfont aui-icon-search"></i>
            <input type="search" placeholder="音乐搜索" id="search-input">
            <div class="aui-searchbar-clear-btn">
                <i class="aui-iconfont aui-icon-close"></i>
            </div>
        </div>
        <button onclick="search()">搜索</button>  <!--更换的button-->
        <!--<div class="button" tapmode onclick="search();search1();">搜索</div>-->
    </div>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript">
    //页面跳转
    //var musics= [];
    localStorage.clear();
    var ot= localStorage.length;
    //alert(ot);

    function search(){
      var value=document.getElementById('search-input').value;
      var query=api.require('query');
      var model=api.require('model');
      model.config({
        appKey: '075A132B-2B11-505D-F01E-FA8B51604C1B',
        appId: 'A6036872544676',
        host: 'https://d.apicloud.com'
      });
      query.createQuery(function(ret,err){
        if(ret && ret.qid){
          query.whereLike({
            qid:ret.qid,
            value:value,
            column:'name'
          });
          model.findAll({
           class: 'music',
           qid: ret.qid
          },function(ret,err){
            if(ret){
              for(var i=0;i<ret.length;i++){
                var na = ret[i].name;
                var url = "http://music.163.com/song/media/outer/url?id="+ret[i].music_id+".mp3";
                ot=ot+1;
                //alert(ot);
                var si = ret[i].singer;

                var song = na+"--"+si;
                //alert(song);
                //alert(song);
                localStorage.setItem(song,ot);
                //var music = [];
                //music.push(na);
                //music.push(url);
                //music.push(si);
                //music.push(ot);
                //musics.push(music);
                //alert(musics);
              }
            }else{
              alert("曲库中没有此歌曲");
            }
            //p = musics.join("-");
            url = "./html/gedan1.html?name="+escape(document.getElementById('search-input').value);
            location.href=url;
          });
        }
      });
    }

    function jump(){
      search();
      //alert(musics);
      /*alert(musics[0][0]);
      alert(musics[0][2]);
      alert(musics[0][4]);
      alert(musics[0][6]);*/
      //p = musics.join("-");
      url = "./html/gedan1.html?name="+escape(document.getElementById('search-input').value);
      location.href=url;
    }

    /*function getCurrentPlayer() {
        demo.getCurrentPlayer(function(ret, err) {
            alert("getCurrentPlayer|" + JSON.stringify(ret));
        });
    }*/

    //添加音乐
    function addMusic(na,fn,ser,oth) {
       demo.addMusic({
           data: {
               name: na,
               filename: fn,
               singer: ser,
               icon: "http://p1.music.126.net/CjOOps_aDbNVz0JpWyfB5Q==/109951163027939634.jpg?param=130y130",
               other: oth,
               fenxiangSum: 3,
               downmusicSum: 33,
               pinglunSum: 44,
               background: "http://7xwc0t.com1.z0.glb.clouddn.com/apicloud/3a3d926564ab4c5b2292744d5ffb0ec6.jpg"
           }
       });
   }

   function apiready() {
        demo = api.require('uimusic');
        demo.addEventListener({
            name: "closeui"
        }, function(ret, err) {
            alert("closeui>>addEventListener|" + JSON.stringify(ret));
        });
        demo.addEventListener({
            name: "pinglun"
        }, function(ret, err) {
            alert("pinglun>>addEventListener|" + JSON.stringify(ret));
        });
        demo.addEventListener({
            name: "fenxiang"
        }, function(ret, err) {
            alert("fenxiang>>addEventListener|" + JSON.stringify(ret));
        });
        demo.addEventListener({
            name: "downmusic"
        }, function(ret, err) {
            alert("downmusic>>addEventListener|" + JSON.stringify(ret));
        });

        demo.addEventListener({
            name: "sharetop"
        }, function(ret, err) {
            alert("sharetop>>addEventListener|" + JSON.stringify(ret));
        });
    }
</script>
</html>
