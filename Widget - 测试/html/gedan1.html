<!DOCTYPE html>
<html>
<head>
    <title>Module Develop</title>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="../script/api.js"></script>
    <style type="text/css">
    html,body {
            width:100%;
            height: 100%;
        }

        body {
            width:100%;
            background-color: #fff;
            margin: 0;
        }

        .music_list {
            font-size: 150%;
            width:100%;
        }
		    .aui-list-item-title{
      			font-size: 100%;
      			border:none;
      			background-color: white;
		    }
    </style>

</head>
<body>
    <div class = 'music_list'>
      <ul class="aui-list aui-list-noborder">
        <li class="aui-list-item">
          <div class="aui-list-item-inner">
            <input class="aui-list-item-title" id="in1" type="button" onclick="selectMusic0()" style="display:none"/>
          </div>
        </li>
      </ul>
      <ul class="aui-list aui-list-noborder">
        <li class="aui-list-item">
          <div class="aui-list-item-inner">
            <input class="aui-list-item-title" id="in2" type="button" onclick="selectMusic1()" style="display:none"/>
          </div>
        </li>
      </ul>
      <ul class="aui-list aui-list-noborder">
        <li class="aui-list-item">
          <div class="aui-list-item-inner">
            <input class="aui-list-item-title" id="in3" type="button" onclick="selectMusic2()" style="display:none"/>
          </div>
        </li>
      </ul>
      <ul class="aui-list aui-list-noborder">
        <li class="aui-list-item">
          <div class="aui-list-item-inner">
            <input class="aui-list-item-title" id="in4" type="button" onclick="selectMusic3()" style="display:none"/>
          </div>
        </li>
      </ul>
      <ul class="aui-list aui-list-noborder">
        <li class="aui-list-item">
          <div class="aui-list-item-inner">
            <input class="aui-list-item-title" id="in5" type="button" onclick="selectMusic4()" style="display:none"/>
          </div>
        </li>
      </ul>
      <ul class="aui-list aui-list-noborder">
        <li class="aui-list-item">
          <div class="aui-list-item-inner">
            <input class="aui-list-item-title" id="in6" type="button" onclick="selectMusic5()" style="display:none"/>
          </div>
        </li>
      </ul>
    </div>
    <button onclick="search()">赋值</button>
</body>
<script type="text/javascript">
    //获取主页面搜索框传递来的数据
    var url = location.search;
    url = unescape(url);
    var name_or_singer = url.substring(url.lastIndexOf('=')+1, url.length);
    var demo;
    var inpArr = document.getElementsByTagName('input');

    var musics = [] //所有搜索过的音乐

    function search(){
        var value=name_or_singer;
        var query=api.require('query');
        var model=api.require('model');
        model.config({
          appKey: '075A132B-2B11-505D-F01E-FA8B51604C1B',
          appId: 'A6036872544676',
          host: 'https://d.apicloud.com'
        });
        query.createQuery(function(ret,err){
          if(ret && ret.qid){
            query.whereLike({
              qid:ret.qid,
              value:value,
              column:'name'
            });
            model.findAll({
             class: 'music',
             qid: ret.qid
            },function(ret,err){
              if(ret){
                for(var i=0;i<ret.length;i++){
                  gedan = ret[i].name+"--"+ret[i].singer;
                  inpArr[i].value=gedan;
                  id = inpArr[i].id;
                  $("#"+id+"").show();

                  //var arr = [];
                  var na = ret[i].name;
                  var url = "http://music.163.com/song/media/outer/url?id="+ret[i].music_id+".mp3";
                  var ot=i+1;
                  var si = ret[i].singer;
                  addMusic(na,url,si,ot);

                  var music = [];
                  music.push(na);
                  music.push(url);
                  music.push(si);
                  music.push(ot);
                  musics.push(music);
                }
              }else{
                alert("曲库中没有此歌曲");
              }
            });
          }
        });
    }

    //window.onload = search;
    //根据歌手名搜索
    function search1(){
       var value = name_or_singer;
       var query = api.require('query');
       var model = api.require('model');
          model.config({
           appKey: '075A132B-2B11-505D-F01E-FA8B51604C1B',
           appId: 'A6036872544676',
           host: 'https://d.apicloud.com'
          });
          query.createQuery(function(ret,err){
        if(ret && ret.qid){
         //console.log(ret.qid)
         query.whereLike({
           qid:ret.qid,
           value:value,
           column:'singer'
         });
         model.findAll({
          class: 'music',
          qid: ret.qid
         },function(ret,err){
           if(ret){
             alert(JSON.stringify( ret ))
           }else{
              alert("曲库中没有此歌手的歌曲");
           }
         });
        }
      });
    }
    //window.onload = search1;


    function getCurrentPlayer() {
        demo.getCurrentPlayer(function(ret, err) {
            alert("getCurrentPlayer|" + JSON.stringify(ret));
        });
    }


    //添加音乐
    function addMusic(na,fn,ser,oth) {
       demo.addMusic({
           data: {
               name: na,
               filename: fn,
               singer: ser,
               icon: "http://p1.music.126.net/CjOOps_aDbNVz0JpWyfB5Q==/109951163027939634.jpg?param=130y130",
               other: oth,
               fenxiangSum: 3,
               downmusicSum: 33,
               pinglunSum: 44,
               background: "http://7xwc0t.com1.z0.glb.clouddn.com/apicloud/3a3d926564ab4c5b2292744d5ffb0ec6.jpg"
           }
       });
   }

    function selectMusic0() {
        var i = 0;
        var name1 = document.getElementById("in1").value;
		    name = name1.match(/(\S*)--/)[1];
        for(var j=0;j<musics.length;j++){
          if(name = music[j][0]){
            i = j+1
          }
        }
        demo.selectMusic({
            other:i
        });
        show();
    }

    function selectMusic1() {
      var i = 0;
      var name1 = document.getElementById("in2").value;
      name = name1.match(/(\S*)--/)[1];
      for(var j=0;j<musics.length;j++){
        if(name = music[j][0]){
          i = j+1
        }
      }
      demo.selectMusic({
          other:i
      });
      show();
    }

    function selectMusic2() {
        demo.selectMusic({
            other:3
        });
        show();
    }

    function selectMusic3() {
        demo.selectMusic({
            other:4
        });
        show();
    }

    function selectMusic4() {
        demo.selectMusic({
            other:5
        });
        show();
    }

    function selectMusic5() {
        demo.selectMusic({
            other:6
        });
        show();
    }

    function selectMusic6() {
        demo.selectMusic({
            other:7
        });
        show();
    }

    function selectMusic7() {
        demo.selectMusic({
            other:8
        });
        show();
    }

    function selectMusic8() {
        demo.selectMusic({
            other:9
        });
        show();
    }

    function selectMusic9() {
        demo.selectMusic({
            other:10
        });
        show();
    }
    //url = "http://music.163.com/song/media/outer/url?id="+ret[n].music_id+".mp3"
    //var musics={'name':'ret[n]name','filename':'url','singer':'ret[n].singer','icon':'http://p1.music.126.net/6F8-Rp8MUvxzrpTjxJiA7A==/109951164764756625.jpg?param=130y130','other':n,fenxiangSum: 43,downmusicSum: 12,pinglunSum: 45,background: "http://7xwc0t.com1.z0.glb.clouddn.com/apicloud/3a3d926564ab4c5b2292744d5ffb0ec6.jpg"}

    function netplay() {
        demo.playMusic({
            musics: [],
            ttf: "widget://res/UKIJTor.ttf",
            downmusicBtn: false,
            fenxiangBtn: true,
            pinglunBtn: true,
            nameTextSize: 20,
            singerTextSize: 16,
            isShowUi: false
        }, function(ret, err) {});
    }

    function show() {
        demo.showUI();
    }

    function apiready() {
        demo = api.require('uimusic');
        demo.addEventListener({
            name: "closeui"
        });
        demo.addEventListener({
            name: "pinglun"
        });
        demo.addEventListener({
            name: "fenxiang"
        });
        demo.addEventListener({
            name: "downmusic"
        });

        demo.addEventListener({
            name: "sharetop"
        });
    }
</script>
</html>
